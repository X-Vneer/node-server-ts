import{r as e}from"./index.df40002d.js";import{u as M,s as v,a as $,P as b,L as U,b as A}from"./motion.a4081b0e.js";function I(){const r=e.useRef(!1);return M(()=>(r.current=!0,()=>{r.current=!1}),[]),r}function K(){const r=I(),[o,t]=e.useState(0),n=e.useCallback(()=>{r.current&&t(o+1)},[o]);return[e.useCallback(()=>v.postRender(n),[n]),o]}class O extends e.Component{getSnapshotBeforeUpdate(o){const t=this.props.childRef.current;if(t&&o.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function S({children:r,isPresent:o}){const t=e.useId(),n=e.useRef(null),m=e.useRef({width:0,height:0,top:0,left:0});return e.useInsertionEffect(()=>{const{width:a,height:i,top:u,left:h}=m.current;if(o||!n.current||!a||!i)return;n.current.dataset.motionPopId=t;const d=document.createElement("style");return document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${i}px !important;
            top: ${u}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[o]),e.createElement(O,{isPresent:o,childRef:n,sizeRef:m},e.cloneElement(r,{ref:n}))}const g=({children:r,initial:o,isPresent:t,onExitComplete:n,custom:m,presenceAffectsLayout:a,mode:i})=>{const u=$(G),h=e.useId(),d=e.useMemo(()=>({id:h,initial:o,isPresent:t,custom:m,onExitComplete:f=>{u.set(f,!0);for(const c of u.values())if(!c)return;n&&n()},register:f=>(u.set(f,!1),()=>u.delete(f))}),a?void 0:[t]);return e.useMemo(()=>{u.forEach((f,c)=>u.set(c,!1))},[t]),e.useEffect(()=>{!t&&!u.size&&n&&n()},[t]),i==="popLayout"&&(r=e.createElement(S,{isPresent:t},r)),e.createElement(b.Provider,{value:d},r)};function G(){return new Map}const R=r=>r.key||"";function T(r,o){r.forEach(t=>{const n=R(t);o.set(n,t)})}function B(r){const o=[];return e.Children.forEach(r,t=>{e.isValidElement(t)&&o.push(t)}),o}const V=({children:r,custom:o,initial:t=!0,onExitComplete:n,exitBeforeEnter:m,presenceAffectsLayout:a=!0,mode:i="sync"})=>{m&&(i="wait");let[u]=K();const h=e.useContext(U).forceRender;h&&(u=h);const d=I(),f=B(r);let c=f;const l=new Set,C=e.useRef(c),E=e.useRef(new Map).current,x=e.useRef(!0);if(M(()=>{x.current=!1,T(f,E),C.current=c}),A(()=>{x.current=!0,E.clear(),l.clear()}),x.current)return e.createElement(e.Fragment,null,c.map(s=>e.createElement(g,{key:R(s),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:a,mode:i},s)));c=[...c];const y=C.current.map(R),w=f.map(R),P=y.length;for(let s=0;s<P;s++){const p=y[s];w.indexOf(p)===-1&&l.add(p)}return i==="wait"&&l.size&&(c=[]),l.forEach(s=>{if(w.indexOf(s)!==-1)return;const p=E.get(s);if(!p)return;const z=y.indexOf(s),L=()=>{E.delete(s),l.delete(s);const k=C.current.findIndex(F=>F.key===s);if(C.current.splice(k,1),!l.size){if(C.current=f,d.current===!1)return;u(),n&&n()}};c.splice(z,0,e.createElement(g,{key:R(p),isPresent:!1,onExitComplete:L,custom:o,presenceAffectsLayout:a,mode:i},p))}),c=c.map(s=>{const p=s.key;return l.has(p)?s:e.createElement(g,{key:R(s),isPresent:!0,presenceAffectsLayout:a,mode:i},s)}),e.createElement(e.Fragment,null,l.size?c:c.map(s=>e.cloneElement(s)))};export{V as A};
